<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رحلة عبور جسر الكرامة</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
    <header class="header">
        <h1>رحلة عبور جسر الكرامة خطوة بخطوة</h1>
        <div class="toggle-switch">
            <input type="radio" name="route" id="toJordan" value="toJordan" checked>
            <label for="toJordan">فلسطين ← الأردن</label>

            <input type="radio" name="route" id="toPalestine" value="toPalestine">
            <label for="toPalestine">الأردن ← فلسطين</label>

            <div class="switch-slider"></div>
        </div>
    </header>


    <div class="progress-container">
        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
            aria-label="تقدم الرحلة"></div>
    </div>
    </header>

    <main class="main-container">
        <div class="timeline-wrapper">
            <div class="timeline" role="tablist" aria-label="خطوات رحلة عبور جسر الكرامة"></div>
        </div>

        <div class="content-container">
            <div class="phase-indicator"></div>
            <div class="step-counter">
                <span id="currentStepNumber">1</span> من <span id="totalSteps">7</span>
            </div>
            <div class="step-navigation">
                <button id="prevBtn" class="nav-button" aria-label="الخطوة السابقة">← السابق</button>
                <button id="nextBtn" class="nav-button" aria-label="الخطوة التالية">التالي →</button>
            </div>
            <div class="content-section" role="tabpanel"></div>
        </div>
    </main>
<footer class="footer" style="text-align:center; padding:20px; background:#f8f9fa; border-top:1px solid #ddd;">
  <p style="margin:0; font-size:14px; color:#333;">
    لا يزال الموقع قيد التطوير | نرحب <strong>باقتراحاتكم</strong>
  </p>

  <form id="suggestionForm" style="margin-top:10px;">
    <input type="text" 
           name="entry.362854911" 
           placeholder="اكتب اقتراحك هنا.." 
           required
           style="padding:10px; width:250px; border:1px solid #ccc; border-radius:5px;">
    
    <button type="submit" 
            style="padding:10px 20px; margin-right:5px; background:#007a3d; color:#fff; border:none; border-radius:5px; cursor:pointer;">
      إرسال
    </button>
  </form>
  <p id="successMsg" style="color:green; display:none; margin-top:10px;">تم إرسال اقتراحك بنجاح!</p>
  <p style="margin-top:15px; font-size:12px; color:#666;">
    تم إنشاؤه بواسطة 
         <a href="https://www.linkedin.com/in/mohammad-dawabsheh-193050308/" target="_blank">mohammad dawabsheh</a>
, <a href="https://www.linkedin.com/in/musabnuirat/" target="_blank">musab nuirat</a>
  </p>
</footer>

<script>
document.getElementById("suggestionForm").addEventListener("submit", function(e) {
  e.preventDefault(); 
  const form = e.target;
  const formData = new FormData(form);

  fetch("https://docs.google.com/forms/d/e/1FAIpQLSfu_7nR--a-j7HQJnieXVrxQ7GfmNRQEikur2JPfLPs4Y4RKQ/formResponse", {
    method: "POST",
    body: formData,
    mode: "no-cors"
  }).then(() => {
    document.getElementById("successMsg").style.display = "block";
    form.reset();
  }).catch(() => {
    alert("حصل خطأ أثناء الإرسال، حاول مرة أخرى.");
  });
});
</script>



    <script>
     document.addEventListener('DOMContentLoaded', () => {
  const timeline = document.querySelector('.timeline');
  const progressBar = document.querySelector('.progress-bar');
  const contentSection = document.querySelector('.content-section');
  const contentContainer = document.querySelector('.content-container');
  const phaseIndicator = document.querySelector('.phase-indicator');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const currentStepNumber = document.getElementById('currentStepNumber');
  const totalSteps = document.getElementById('totalSteps');
  const routeRadios = document.querySelectorAll('input[name="route"]');
let allSteps = [];


  let stepsData = [];
  let currentStep = 0;
async function fetchSteps() {
  try {
    const response = await fetch("https://bridge-cms.onrender.com/api/steps?populate=*");
    const data = await response.json();

    allSteps = data.data.map(item => ({
  step: item.step,
  title: item.Title,
  icon: item.icon,
  phase: item.phase,
  phaseName: item.phaseName,
  direction: item.direction,
  contentTitle: item.Content?.title,
  contentText: item.Content?.text,
impNote: item.Content?.Imp_note,
contentText1: item.Content?.text1
}));


    const stepsToJordan = allSteps
      .filter(s => s.direction === "palestine to jordan")
      .sort((a,b) => a.step - b.step);

    const stepsToPalestine = allSteps
      .filter(s => s.direction === "jordan to palestine")
      .sort((a,b) => a.step - b.step);

    stepsData = stepsToJordan; 
    totalSteps.textContent = stepsData.length;

    currentStep = loadProgress();

    renderTimeline();
    renderContent();
    updateProgressBar();
    updatePhaseIndicator();
    document.body.style.opacity = '1';

  } catch (error) {
    console.error("Error fetching steps:", error);
  }
}

fetchSteps();
function renderContent() {
  const step = stepsData[currentStep];
  if (!step) return;

  contentSection.innerHTML = `
    <h2 class="content-title">${step.contentTitle || ''}</h2>
    <div>${renderRichText(step.contentText)}</div>
    ${step.impNote ? `<div class="cost-highlight1">${renderRichText(step.impNote)}</div>` : ''}
        ${step.contentText1 ? `<div>${step.contentText1}</div>` : ''}

  `;

  prevBtn.disabled = currentStep === 0;
  nextBtn.disabled = currentStep === stepsData.length - 1;
  currentStepNumber.textContent = currentStep + 1;
  nextBtn.innerHTML = currentStep === stepsData.length - 1 ? '✓ اكتمال الرحلة' : 'التالي ←';
  prevBtn.innerHTML = currentStep === 0 ? '→ البداية' : '→ السابق';
}
function renderRichText(blocks) {
  if (!blocks) return '';

  return blocks.map(block => {
    const type = block.type;
    const children = block.children || [];

    const inner = children.map(child => {
      if (child.text !== undefined) {
        let t = child.text;
        if (child.bold) t = `<strong>${t}</strong>`;
        if (child.italic) t = `<em>${t}</em>`;
        if (child.underline) t = `<u>${t}</u>`;
        return t;
      } else if (child.type && child.children) {
        return renderRichText([child]); 
      }
      return '';
    }).join('');

    switch(type) {
      case 'paragraph': return `<p>${inner}</p>`;
      case 'heading': return `<h3>${inner}</h3>`;
      case 'bulletList': 
        return `<ul>${children.map(item => renderRichText([item])).join('')}</ul>`;
      case 'orderedList': 
        return `<ol>${children.map(item => renderRichText([item])).join('')}</ol>`;
      case 'list-item': 
        return `<li>${inner}</li>`;
      case 'quote': return `<blockquote>${inner}</blockquote>`;
      case 'link': return `<a href="${block.url}" target="_blank" rel="noopener noreferrer">${inner}</a>`;
      default: return inner;
    }
  }).join('');
}


function showStep(stepIndex) {
  currentStep = stepIndex;
  renderTimeline();
  renderContent();
  updateProgressBar();
  updatePhaseIndicator();
  saveProgress();
}



function setRoute(route) {
  if (!stepsData || !stepsData.length) return;

  if (route === 'toJordan') {
    stepsData = allSteps.filter(s => s.direction === "palestine to jordan").sort((a,b)=>a.step-b.step);
  } else {
    stepsData = allSteps.filter(s => s.direction === "jordan to palestine").sort((a,b)=>a.step-b.step);
  }

  totalSteps.textContent = stepsData.length;
  currentStep = 0; 
  renderTimeline();
  renderContent();
  updateProgressBar();
  updatePhaseIndicator();
  saveProgress();
}

routeRadios.forEach(radio => {
  radio.addEventListener('change', e => setRoute(e.target.value));
});


            routeRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    setRoute(e.target.value);
                });
            });

            function createTimelineStep(step, index) {
    const stepDiv = document.createElement('div');
    stepDiv.classList.add('timeline-step', step.phase);
    stepDiv.setAttribute('role', 'tab');
    stepDiv.setAttribute('aria-selected', index === currentStep ? 'true' : 'false');
    stepDiv.setAttribute('tabindex', index === currentStep ? '0' : '-1');

    if (index === currentStep) stepDiv.classList.add('active');
    else if (index < currentStep) stepDiv.classList.add('completed');

    stepDiv.innerHTML = `
        <div class="step-icon" aria-hidden="true">
            <span class="step-number">${index + 1}</span>
            <i data-lucide="${step.icon}" class="w-6 h-6 text-blue-500"></i>
        </div>
        <div class="timeline-step-title">${step.title}</div>
        <div class="sr-only">خطوة ${index + 1} من ${stepsData.length}: ${step.title}</div>
    `;

    stepDiv.addEventListener('click', () => goToStep(index));
    stepDiv.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            goToStep(index);
        }
    });

    return stepDiv;
}


            function renderTimeline() {
                timeline.innerHTML = '';
                stepsData.forEach((step, index) => timeline.appendChild(createTimelineStep(step, index)));
                lucide.createIcons();
            }

           function updateProgressBar() {
    if (!stepsData[currentStep]) return; 
    const progress = (currentStep / (stepsData.length - 1)) * 100;
    progressBar.style.width = `${progress}%`;
    progressBar.setAttribute('aria-valuenow', Math.round(progress));

    const currentPhase = stepsData[currentStep].phase;
    if (currentPhase === 'palestinian-phase') progressBar.style.background = 'var(--gradient-palestinian)';
    else if (currentPhase === 'israeli-phase') progressBar.style.background = 'var(--gradient-israeli)';
    else if (currentPhase === 'jordanian-phase') progressBar.style.background = 'var(--gradient-jordanian)';
}

function updatePhaseIndicator() {
    const step = stepsData[currentStep];
    if (!step) return; 

    const currentPhase = step.phase;
    const phaseName = step.phaseName;
    phaseIndicator.className = `phase-indicator ${currentPhase}`;
    phaseIndicator.textContent = phaseName;
    contentContainer.className = `content-container ${currentPhase}`;
}

          
            function goToStep(stepIndex) {
                if (stepIndex >= 0 && stepIndex < stepsData.length) {
                    showLoadingAnimation();
                    setTimeout(() => {
                        currentStep = stepIndex;
                        renderTimeline();      
                        renderContent();
                        updateProgressBar();
                        updatePhaseIndicator();
                        saveProgress();

                        const wrapper = document.querySelector('.timeline-wrapper');
                        const activeStep = document.querySelector('.timeline-step.active');
                        if (activeStep) {
                            const wrapperRect = wrapper.getBoundingClientRect();
                            const stepRect = activeStep.getBoundingClientRect();
                            const offset = stepRect.left - wrapperRect.left - wrapper.clientWidth / 2 + stepRect.width / 2;

                            wrapper.scrollBy({
                                left: offset,
                                behavior: 'smooth'
                            });
                        }

                    }, 100);
                }
            }


            function showLoadingAnimation() {
                contentSection.style.opacity = '0';
                contentSection.style.transform = 'translateY(20px) scale(0.95)';
                contentSection.style.filter = 'blur(2px)';

                setTimeout(() => {
                    contentSection.style.opacity = '1';
                    contentSection.style.transform = 'translateY(0) scale(1)';
                    contentSection.style.filter = 'blur(0)';
                }, 200);
            }

            function saveProgress() { localStorage.setItem('kerameh-bridge-progress', currentStep.toString()); }

            function loadProgress() {
                const saved = localStorage.getItem('kerameh-bridge-progress');
                if (saved !== null) {
                    const savedStep = parseInt(saved, 10);
                    if (savedStep >= 0 && savedStep < stepsData.length) return savedStep;
                }
                return 0;
            }

            nextBtn.addEventListener('click', () => { if (currentStep < stepsData.length - 1) goToStep(currentStep + 1); });
            prevBtn.addEventListener('click', () => { if (currentStep > 0) goToStep(currentStep - 1); });

            document.addEventListener('keydown', (e) => {
                if (e.target.closest('.timeline-step')) return;
                if (e.key === 'ArrowLeft' && currentStep > 0) { e.preventDefault(); goToStep(currentStep - 1); }
                if (e.key === 'ArrowRight' && currentStep < stepsData.length - 1) { e.preventDefault(); goToStep(currentStep + 1); }
            });

            let startX = null, startY = null;
            contentContainer.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; startY = e.touches[0].clientY; });
            contentContainer.addEventListener('touchend', (e) => {
                if (!startX || !startY) return;
                const diffX = startX - e.changedTouches[0].clientX;
                const diffY = startY - e.changedTouches[0].clientY;
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                    if (diffX > 0 && currentStep < stepsData.length - 1) goToStep(currentStep + 1);
                    else if (diffX < 0 && currentStep > 0) goToStep(currentStep - 1);
                }
                startX = null; startY = null;
            });

            function init() {
                currentStep = loadProgress();
                renderTimeline();
                renderContent();
                updateProgressBar();
                updatePhaseIndicator();
                document.body.style.opacity = '1';
            }

            init();
        });
    </script>
</body>

</html>